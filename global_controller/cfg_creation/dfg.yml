machines:
    - &dedos01
      ip: 158.130.57.62
      runtime_id: 1
    - &dedos02
      ip: 158.130.56.192
      runtime_id: 2

types:
    ssl_read: &ssl-read
        vertex_type: nop
        type: 500
        meta_routing:
            source_types: [502]
            dst_types: [501]
    http: &http
        vertex_type: nop
        type: 501
        meta_routing:
            source_types: [500]
            dst_types: [505, 503]
    ssl-routing: &ssl-routing
        vertex_type: entry
        type: 502
        meta_routing:
            dst_types: [500]
    ssl_write: &ssl-write
        vertex_type: exit
        type: 503
        meta_routing:
            source_types: [505, 501]
    regex: &regex
        vertex_type: nop
        type: 505
        meta_routing:
            source_types: [500]
            dst_types: [503]

global_ctl:
    <<: *dedos01
    port: 8080

application:
    load_mode: preload
    name: dedos_webserver
    deadline: 10

default_runtime: &default_runtime
    port: 4444
    num_cores: 8
    dram: 67108864
    io_network_bw: 10485760

runtimes:
    1: &rt1
        <<: *dedos01
        <<: *default_runtime
    2: &rt2
        <<: *dedos02
        <<: *default_runtime

default_msus:
    - &default_msu
      vertex_type: nop
      working_mode: non-blocking
      profiling:
          wcet: 10
          dram: 500MB
          tx_node_local: 1
          tx_core_local: 0.5
          tx_node_remote: 25
      deadline: 5
    - &rt1-msu
      <<: *default_msu
      scheduling:
          <<: *dedos01
    - &rt2-msu
      <<: *default_msu
      scheduling:
          <<: *dedos02

msus:
    - name: ssl-route
      <<: *rt1-msu
      <<: *ssl-routing
      thread: 1

    - name: ssl-read1
      <<: *rt1-msu
      <<: *ssl-read
      thread: 1
      reps: 1

    - name: http1
      <<: *rt1-msu
      <<: *http
      thread: 1
      reps: 1

    - name: regex
      <<: *rt1-msu
      <<: *regex
      thread: 2
      reps: 14

#    - name: regex2
#      <<: *rt2-msu
#      <<: *regex
#      thread: 1
#      reps: 16

    - name: ssl-write1
      <<: *rt1-msu
      <<: *ssl-write
      thread: 1


    # RUNTIME 2 
    #- &HTTP_RT2
    # name: http-rt2
    # <<: *rt2-nb
    # <<: *http
    # thread: 1
    #- <<: *HTTP_RT2
    #  name: http-rt2-2
    #  thread: 2
    #- <<: *HTTP_RT2
    #  name: http-rt2-3
    #  thread: 3
    #- <<: *HTTP_RT2
    # name: http-rt2-4
    # thread: 4




routes:
    - from: ssl-route
      to: ssl-read1
      thread-match: false

    - from: ssl-read1
      to: http1
      thread-match: true

    - from: http1
      to: [regex] #, regex2]
      thread-match: false

    - from: [http1, regex] #, regex2]
      to: ssl-write1
      thread-match: false

      #- from: [http-rt1, http-rt2, http-rt2-2, http-rt2-3, http-rt2-4]
      #to: ssl-write-rt1
